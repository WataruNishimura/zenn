---
title: "AWSでIAM Identity CenterとGoogle WorkspaceでSSOのAWSマルチアカウント運用をしてみる"
emoji: "🐕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["aws"]
published: false
---

こんにちは、札幌のエンジニアn13uです
今日はAWS IAM Identity CenterとGoogle Workspace のSAML/SCIM連携を利用したマルチアカウント連携&運用の記事です。


## 概要

AWS IAM Identity Center / AWS Organizationsを利用しAWSアカウント管理するとともに、Google Workspaceを外部Idpに設定しSSO（シングルサインオン）ができるようになるとともにSCIMを利用した自動プロビジョニングまで設定します。

:::message
本記事ではAWSのマルチアカウント運用のベストプラクティスや必要性、AWS OrganizationのOU設計のベストプラクティス等については触れていません
:::


## 基礎知識

本記事を進めていく前に、前提知識となるIAMユーザーに関する情報や、理解の落とし穴になる知識から触れていきます。
理解している方は飛ばしていただいて構いません🙆‍♀

### IAMユーザー、AWSアカウントの基本と違いについて

#### IAMユーザーとは？

AWS上のリソース（EC2やS3など）を扱う際に、それらを安全に管理するための認証・認可のサービス、**IAM**で扱うユーザーを指しています。

認証は「誰」を確認（操作や管理に適切な実体であるか）し、認可では「権限」を確認して実行・管理に「許可」を与えます。

この認証と認可を同時に「人（もしくはAWSリソースのユーザー）」に対して行うことができるのが **IAMユーザー** です。

IAMユーザーは基本的に、１人に対して複数設定することができ、IAMユーザーごとに異なった権限設定と
認可を行うことで都度適切な範囲でのリソース操作を可能にします。

ここから先重要になるのは、**IAMユーザーはAWSアカウントに紐づく** ということです。

#### AWSアカウントとは？

AWSアカウントはアカウントと名前はついていますが、リソースを管理するための「箱庭」のようなものだと考えてください。AWSのリソースは、AWSアカウントという「箱庭」の中に置かれています。それらのリソースを権限管理されたIAMユーザーが管理するといった関係性です。

AWSアカウントの管理者である、ルートユーザーは、IAMユーザーの中で「箱庭」を管理できる全権限をもったユーザーです。

AWSを使っているうちに１つのAWSアカウント内で、IAMユーザーを複数発行することによって権限管理していくだけでは必要な管理ができず、「箱庭そのもの」を別に作り、その中でリソースを管理したくなるケースがあります。

例えば、あるAWSアカウントには本番環境で動いているサービスのEC2インスタンスがあるとします。同じアカウント内に学習用で使っている別のEC2インスタンスがあったとき、間違えて本番環境を削除することがないようにしたいです。

こういったケースではAWSアカウントを複数作成し、それぞれの「箱庭」を分ける**マルチアカウント運用**が必要になってきます。

### AWS Organization を利用したマルチアカウント運用

### AWS Identity Centerとは？

#### AWS Identity Center ワークフォースユーザーとAWS IAM ユーザーの違い

### SAML2.0とSCIMについて

## 基本事項

- AWSアカウントはAWS Organization

## AWS IAM Identity Centerで外部IdpにGoogle Workspaceを設定

## Google WorkspaceでSAML2.0とSCIMの設定

## Google Workspace ユーザーとワークフォースユーザーとAWSアカウントの紐づけ

## 実際にログインをしてみる


